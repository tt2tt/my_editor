@startuml ArchitectureDiagram
' MVC構造のクラス図。ControllerがModelとView間の仲介を行う。
skinparam style strictuml
skinparam packageStyle rectangle
skinparam backgroundColor #f5f5f5
skinparam ArrowColor #333333
skinparam ArrowThickness 1
skinparam defaultTextAlignment center

package "Model" {
  class FileModel {
    +load_file(path: Path): str
    +save_file(path: Path, content: str): None
    +list_open_files(): list
  }

  class FolderModel {
    +list_directory(path: Path): list
    +create_item(path: Path, is_dir: bool): None
    +delete_item(path: Path): None
  }

  class SettingsModel {
    +load_settings(): dict
    +save_settings(data: dict): None
    +get_api_key(): str | None
    +set_api_key(key: str): None
  }
}

package "View" {
  class MainWindow {
    +show(): None
    -_build_layout(): None
    -_connect_signals(): None
  }

  class EditorTab {
    +display_content(text: str): None
    +mark_dirty(is_dirty: bool): None
  }

  class FolderTree {
    +render(nodes: list): None
    +request_open(path: Path): None
  }

  class ChatPanel {
    +append_user_message(message: str): None
    +append_ai_message(message: str): None
    +request_completion(prompt: str): None
  }
}

package "Controller" {
  class AppController {
    +start(): None
    -_wire_events(): None
  }

  class FileController {
    +open_file(path: Path): None
    +save_current_file(): None
    +mark_dirty(tab_id: str, is_dirty: bool): None
  }

  class AIController {
    +generate_code(prompt: str): str
    +handle_chat_submit(message: str): None
  }
}

AppController --> MainWindow : controls
AppController --> FileController : coordinates
AppController --> AIController : coordinates
AppController --> SettingsModel : uses

FileController --> FileModel : uses
FileController --> EditorTab : updates
FileController --> FolderModel : queries

AIController --> ChatPanel : updates
AIController --> SettingsModel : reads/writes
AIController --> FileModel : optional_context

MainWindow o-- EditorTab : owns
MainWindow o-- FolderTree : owns
MainWindow o-- ChatPanel : owns

FolderTree --> AppController : notifies
EditorTab --> FileController : emits_dirty
ChatPanel --> AIController : submits_prompt

@enduml
